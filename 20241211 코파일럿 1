import sys
import socket
from PyQt5.QtWidgets import QApplication, QMainWindow, QTextBrowser, QVBoxLayout, QWidget

class UDPReceiver(QWidget):
    def __init__(self):
        super().__init__()
        self.initUI()
        
        self.sock = socket.socket(socket.AF_INET, socket.SOCK_DGRAM)
        self.sock.bind(('0.0.0.0', 12345))  # 12345 포트에서 수신
        
        # self.sock.setblocking(False)  # 비블로킹 모드 설정 제거

    def initUI(self):
        self.layout = QVBoxLayout()
        self.textBrowser = QTextBrowser()
        self.layout.addWidget(self.textBrowser)
        self.setLayout(self.layout)

    def receiveData(self):
        while True:
            data, _ = self.sock.recvfrom(1024)  # 최대 1024바이트 수신
            self.textBrowser.append(data.decode('utf-8'))

class MainWindow(QMainWindow):
    def __init__(self):
        super().__init__()
        self.initUI()

    def initUI(self):
        self.setWindowTitle('UDP Receiver')
        self.setGeometry(100, 100, 600, 400)
        self.receiver = UDPReceiver()
        self.setCentralWidget(self.receiver)

if __name__ == '__main__':
    app = QApplication(sys.argv)
    mainWindow = MainWindow()
    mainWindow.show()

    import threading
    thread = threading.Thread(target=mainWindow.receiver.receiveData)
    thread.daemon = True
    thread.start()

    sys.exit(app.exec_())
